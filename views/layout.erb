<!DOCTYPE html>
<html lang="en">
  <head>
    <title><%= @page_title || "Yonderbook | Find Your Goodreads Books Free at Libraries & Book Swaps" %></title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="<%= @page_description || "Turn your Goodreads want-to-read list into free books. Automatically find your books at your local library via Libby/OverDrive and through BookMooch book trading. Never buy a book that's free again." %>">
    <meta name="keywords" content="Goodreads, Libby, OverDrive, BookMooch, free books, library ebooks, book trading, want to read, reading list, free audiobooks, library catalog search">

    <!-- Canonical URL -->
    <link rel="canonical" href="<%= @canonical_url || "https://yonderbook.com#{request.path}" %>">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="<%= @canonical_url || "https://yonderbook.com#{request.path}" %>">
    <meta property="og:title" content="<%= @og_title || @page_title || "Yonderbook | Find Your Goodreads Books Free at Libraries & Book Swaps" %>">
    <meta property="og:description" content="<%= @og_description || @page_description || "Turn your Goodreads want-to-read list into free books. Automatically find your books at your local library and through book trading." %>">
    <meta property="og:image" content="<%= @og_image || "https://yonderbook.com/img/yonderbook.png" %>">
    <meta property="og:site_name" content="Yonderbook">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="<%= @canonical_url || "https://yonderbook.com#{request.path}" %>">
    <meta property="twitter:title" content="<%= @twitter_title || @og_title || @page_title || "Yonderbook | Find Your Goodreads Books Free" %>">
    <meta property="twitter:description" content="<%= @twitter_description || @og_description || @page_description || "Turn your Goodreads want-to-read list into free books from your library and book swaps." %>">
    <meta property="twitter:image" content="<%= @twitter_image || @og_image || "https://yonderbook.com/img/yonderbook.png" %>">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/svg/favicon.svg?v=2">

    <!-- Preload critical resources for faster loading -->
    <%= preload_assets_link_tags(:css) %>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;0,700;1,400&display=swap" as="style">

    <!-- Load fonts with display=swap for better performance -->
    <link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <!-- Tailwind CSS with Custom Colors -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'brand': '#501229',
              'secondary': '#369b9a'
            }
          }
        }
      }
    </script>

    <%= assets(:css) %>

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Yonderbook",
      "url": "https://yonderbook.com",
      "description": "Turn your Goodreads want-to-read list into free books. Find your books at libraries via Libby/OverDrive and through BookMooch book trading.",
      "applicationCategory": "UtilitiesApplication",
      "operatingSystem": "Web",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "5",
        "ratingCount": "1"
      },
      "featureList": [
        "Import Goodreads shelves",
        "Find books at local libraries",
        "Check Libby/OverDrive availability",
        "BookMooch integration",
        "Reading analytics",
        "Author diversity tracking"
      ]
    }
    </script>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Yonderbook",
      "url": "https://yonderbook.com",
      "logo": "https://yonderbook.com/svg/book-nav.svg",
      "sameAs": []
    }
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-96996170-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-96996170-1');
    </script>

    <!-- Pixel Code - https://app.tinyanalytics.io/ -->
    <script defer src="https://app.tinyanalytics.io/pixel/KyJ6JipBW9No4r00"></script>
    <!-- END Pixel Code -->
  </head>

  <body class="flex flex-col min-h-screen bg-gradient-to-t from-[#CAf7eb] to-[#138586]">
    <main class="flex-1">
      <nav class="bg-white shadow-sm border-b border-gray-100 sticky top-0 z-50 rounded-b-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between items-center h-16">
            <!-- Logo -->
            <div class="flex-shrink-0">
              <a href="/" class="flex items-center space-x-2 text-2xl font-bold text-brand transition-colors duration-200">
                <img src="/svg/book-nav.svg" alt="Book" class="w-8 h-8 text-brand">
                <span class="brand-logo bg-gradient-to-r from-maroon-600 to-maroon-800 bg-clip-text text-transparent font-black font-coats">
                  Yonderbook
                </span>
              </a>
            </div>

            <!-- Desktop Navigation -->
            <div class="hidden md:block">
              <div class="ml-10 flex items-center space-x-1">
                <a href="/about"
                   class="group inline-flex items-center px-3 py-2 text-sm font-medium text-gray-600 hover:text-brand hover:bg-gray-50 rounded-lg transition-all duration-200">
                  <img src="/svg/info-circle.svg" alt="About" class="w-4 h-4 mr-2 text-gray-400 group-hover:text-maroon-500">
                  About
                </a>

                <% if rodauth.logged_in? %>
                  <a href="/home"
                     class="group inline-flex items-center px-3 py-2 text-sm font-medium text-gray-600 hover:text-brand hover:bg-gray-50 rounded-lg transition-all duration-200">
                    <img src="/svg/book.svg" alt="Home" class="w-4 h-4 mr-2 text-gray-400 group-hover:text-maroon-500">
                    Home
                  </a>
                  <% if @user&.goodreads_connected? %>
                  <a href="/connections/goodreads/shelves"
                     class="group inline-flex items-center px-3 py-2 text-sm font-medium text-gray-600 hover:text-brand hover:bg-gray-50 rounded-lg transition-all duration-200">
                    <img src="/svg/book.svg" alt="Shelves" class="w-4 h-4 mr-2 text-gray-400 group-hover:text-maroon-500">
                    Shelves
                  </a>
                  <% end %>
                  <a href="/connections"
                     class="group inline-flex items-center px-3 py-2 text-sm font-medium text-gray-600 hover:text-brand hover:bg-gray-50 rounded-lg transition-all duration-200">
                    <img src="/svg/checkmark-badge.svg" alt="Connections" class="w-4 h-4 mr-2 text-gray-400 group-hover:text-maroon-500">
                    Connections
                  </a>
                  <a href="/account"
                     class="group inline-flex items-center px-3 py-2 text-sm font-medium text-gray-600 hover:text-brand hover:bg-gray-50 rounded-lg transition-all duration-200">
                    <img src="/svg/user.svg" alt="Account" class="w-4 h-4 mr-2 text-gray-400 group-hover:text-maroon-500">
                    Account
                  </a>
                <% else %>
                  <a href="/authenticate"
                     class="group inline-flex items-center px-3 py-2 text-sm font-medium text-gray-600 hover:text-brand hover:bg-gray-50 rounded-lg transition-all duration-200">
                    <img src="/svg/user.svg" alt="Login" class="w-4 h-4 mr-2 text-gray-400 group-hover:text-maroon-500">
                    Login
                  </a>
                  <a href="/sign-up"
                     class="group inline-flex items-center px-3 py-2 ml-2 text-sm font-medium text-white bg-brand hover:bg-opacity-90 rounded-lg transition-all duration-200">
                    Sign Up
                  </a>
                <% end %>
              </div>
            </div>

            <!-- Mobile menu button -->
            <div class="md:hidden">
              <button type="button"
                      class="mobile-menu-button inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500"
                      onclick="toggleMobileMenu()">
                <img src="/svg/menu.svg" alt="Menu" class="block h-6 w-6">
              </button>
            </div>
          </div>

          <!-- Mobile Navigation -->
          <div class="mobile-menu hidden md:hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 bg-white border-t border-gray-100">
              <a href="/about"
                 class="block px-3 py-2 text-base font-medium text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors duration-200">
                About
              </a>

              <% if rodauth.logged_in? %>
                <a href="/home"
                   class="block px-3 py-2 text-base font-medium text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors duration-200">
                  Home
                </a>
                <% if @user&.goodreads_connected? %>
                <a href="/connections/goodreads/shelves"
                   class="block px-3 py-2 text-base font-medium text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors duration-200">
                  Shelves
                </a>
                <% end %>
                <a href="/connections"
                   class="block px-3 py-2 text-base font-medium text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors duration-200">
                  Connections
                </a>
                <a href="/account"
                   class="block px-3 py-2 text-base font-medium text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors duration-200">
                  Account
                </a>
              <% else %>
                <a href="/authenticate"
                   class="block px-3 py-2 text-base font-medium text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors duration-200">
                  Login
                </a>
                <a href="/sign-up"
                   class="block px-3 py-2 text-base font-medium text-white bg-brand hover:bg-opacity-90 rounded-md transition-colors duration-200">
                  Sign Up
                </a>
              <% end %>
            </div>
          </div>
        </div>
      </nav>

      <%= partial 'flash_notifications' %>

      <div class="max-w-7xl mx-auto px-4 md:px-8 pt-8">
        <%= yield %>
      </div>
    </main>

    <!-- Custom JavaScript -->
    <script>
      // Mobile menu toggle function
      function toggleMobileMenu() {
        var mobileMenu = document.querySelector('.mobile-menu');
        mobileMenu.classList.toggle('hidden');
      }

      // Auto-dismiss flash messages with fade out
      document.addEventListener('DOMContentLoaded', function() {
        ['flash-error', 'flash-notice'].forEach(function(id) {
          var el = document.getElementById(id);
          if (el) {
            setTimeout(function() { el.style.opacity = '0'; }, 3500);
            setTimeout(function() { el.remove(); }, 4000);
          }
        });
      });
    </script>

    <!--Start of Tawk.to Script-->
    <script type="text/javascript">
    var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
    (function(){
    var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
    s1.async=true;
    s1.src='https://embed.tawk.to/68d6960634eabc19222ddc76/1j633k22v';
    s1.charset='UTF-8';
    s1.setAttribute('crossorigin','*');
    s0.parentNode.insertBefore(s1,s0);
    })();
    </script>
    <!--End of Tawk.to Script-->
  </body>
</html>
