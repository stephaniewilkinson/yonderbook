<%
  # Build summary lines for header
  summary_lines = []
  unless @books_added.empty?
    summary_lines << "Added #{@books_added.size} books to your BookMooch wishlist."
    summary_lines << "Couldn't add #{@books_failed.size} books." if @books_failed.size > 0
    summary_lines << "#{@books_failed_no_isbn.size} books could not be matched (missing ISBN)." if @books_failed_no_isbn.size > 0
  end

  header = {
    title: @books_added.empty? ? 'No Books Added' : 'Success!',
    summary_lines: @books_added.empty? ? nil : summary_lines
  }

  tabs = [
    {
      label: 'Added',
      title: "These #{@books_added.size} books are now on your wishlist",
      color: 'green',
      count: @books_added.size,
      empty_message: 'No books were added to your wishlist.',
      books: @books_added.map do |book|
        {
          image: book[:image_url],
          title: book[:title],
          author: book[:author] || 'Unknown Author',
          isbn: book[:bookmooch_isbn],
          button: book[:bookmooch_isbn] ? {
            url: "https://bookmooch.com/m/detail/#{book[:bookmooch_isbn]}",
            label: 'View on BookMooch',
            class: 'bg-emerald-600 hover:bg-emerald-700'
          } : nil
        }
      end
    },
    {
      label: "Couldn't Add",
      title: "Couldn't Add #{@books_failed.size} Books",
      color: 'red',
      count: @books_failed.size,
      description: "If some books imported but not others, it's possible that BookMooch doesn't have them listed. Try adding them to your wishlist using a different edition, aka a different ISBN.",
      empty_message: 'All books were successfully added!',
      books: @books_failed.map do |book|
        {
          image: book[:image_url],
          title: book[:title],
          author: book[:author] || 'Unknown Author'
        }
      end
    },
    {
      label: 'Could Not Match',
      title: "Could Not Match #{@books_failed_no_isbn.size} Books",
      color: 'gray',
      count: @books_failed_no_isbn.size,
      description: 'These books are missing ISBN information in Goodreads. Without an ISBN, we cannot match them to the BookMooch catalog. Try editing the book details in Goodreads to add ISBN information.',
      empty_message: 'All books on your shelf have ISBN numbers!',
      books: @books_failed_no_isbn.map do |book|
        {
          image: book[:image_url],
          title: book[:title],
          author: book[:author] || 'Unknown Author'
        }
      end
    }
  ]
%>

<%= render('_tabbed_availability_results', locals: {header: header, tabs: tabs}) %>
